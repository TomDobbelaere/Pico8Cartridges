pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
cam = {
	x=0,
	y=0,
	d=2
}

player = {
	x=0,
	y=0,
	xv=0,
	yv=0
}

bgactors = {}

function _init()
	music(0)
	
	for yv=0,32 do
		for xv=0,128 do
			local mg = mget(xv, yv)
			if (mg == 17) then
				add(bgactors, {
					x=8*xv,
					y=8*yv
				})
			elseif (mg == 8) then
				player.x = 8*xv
				player.y = 8*yv
			end
		end
	end
end

function solid(x,y)
	return fget(mget(x/8,y/8), 0)
end

function colliding(x,y)
	return solid(x,y) 
	or solid(x+7,y)
	or solid(x,y+7)
	or solid(x+7,y+7)
end

function btnf(n) return btn(n) and 1 or 0 end


function _draw()
	cls()
	
	cam.x = player.x-64
	cam.y = player.y-64
	
	camera(cam.x,cam.y)
	
	for y=-1,16 do
		for x=-1,16 do
			spr(2,cam.x+x*8+cam.x/-cam.d%8,cam.y+y*8+cam.y/-cam.d%8)
		end
	end
	
	for actor in all(bgactors) do
		spr(17,(cam.x+actor.x)+cam.x/-cam.d,(cam.y+actor.y)+cam.y/-cam.d,2,3)
	end
	--pal(8,9)
	--pal(2,4)
	--pal(1,2)
	
	map(0,0,0,0,128,32,2)
	--spr(8,player.x,player.y,8,8)
	if not colliding(player.x,player.y+1) then
		if player.yv<0 then
			sspr(10*8,0,8,8,player.x,player.y,8,8,player.xv<0)
		else
			sspr(9*8,0,8,8,player.x,player.y,8,8,player.xv<0)
		end
	else
		sspr(8*8,0,8,8,player.x,player.y,8,8,player.xv<0)
	end
	
	
end

function _update60()
	player.xv+=(btnf(1)-btnf(0))*0.3
	player.xv*=0.8
	
	if (colliding(player.x,player.y+1)) then
		if (btnp(4) and not colliding(player.x,player.y-1)) then
			player.yv-=3
			sfx(0)
		end	
	else
		player.yv+=0.25
	end
	
	if (colliding(player.x+player.xv,player.y)) then
		while not colliding(player.x+sgn(player.xv),player.y) do
			player.x+=sgn(player.xv)
		end
	else
		player.x+=player.xv
	end
	
	if (colliding(player.x,player.y+player.yv)) then
		local falling=player.yv>0
		while not colliding(player.x,player.y+sgn(player.yv)) do
			player.y+=sgn(player.yv)
		end
		player.yv=0
	else
		player.y+=player.yv
	end
end
__gfx__
00000000888888881111111100000000555555555555555550000000000000000077770000777700007777000000000000000000000000000000000000000000
00000000888828212221222100000000ddd5ddd5ddd5ddd5500000000000000000f5f50000ffff0000f5f5f00000000000000000000000000000000000000000
00700700882822212111211100600060d555d555d555d555500000000000000000ffff0000f5f50000ffff300000000000000000000000000000000000000000
0007700088222221111111110060006055555555555555555000000000000000003bbb00033bb330033bb3300000000000000000000000000000000000000000
0007700082222211111111110650065055111155555555555000000000000000003bbb000fbbbbf00fbbbb000000000000000000000000000000000000000000
00700700882222212212221206500650d144441ddd5ddd5d500000000000000000fccc0000cccc0000cccc000000000000000000000000000000000000000000
000000008211212111121112065006505144441d555d555d500000000000000000c00c0000400c0000c004000000000000000000000000000000000000000000
00000000111111111111111106500650144444415555555550000000000000000040040000000400004000000000000000000000000000000000000000000000
00000000000004444440000000000000144444410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000041111114000000000000144444410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000004177c5cc1400000000000144444410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000041757575c514000000000014444a910000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000041c57577c5cc14000000000144444410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000415ccc5c5c5c14000000000144444410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000041c5c5c5777514000000000144444410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000411cc5cc7575711400000000144444410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000411c5c5c5c5cc11400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000004115ccc5ccc5c11400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000411c5c5c5c5c511400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000411cc5ccc5ccc11400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000411c5c5c5c5c511400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000004115ccc5ccc5c11400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000411111111111111400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000444444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020
20202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020
20202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0003030202020200000000000000000002000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001000000010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001000101010101010600000000000000000000000000010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001000000010101050600000000000000000000000000000101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001010100010105050600000000000000000000000000000001010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000111200000001000000010505050600111200000000000000001112000000010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000212200000001000101010504050600212200101000010101002122000000010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000313200000001000000010514050608313200101000010101003132000000010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001010100010101010101030301010101010101010100000000010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001000000010101010101010101010101010101010101000000010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001000101010101010101010101010101010101010101010000010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001000000000000000000000000000000000000000000000000010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001010000000000000000000000000000000000000000000101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001010100000000000000000000000000000000000000000101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001010101000000000000000000000000000000000001010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001010101010000000000000000000000000000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001010101010101010101000000010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001010101010101010101000000010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001010101010101010101030303010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
01050000167701807124071320002300013000180001e0002c0002c0002c0001500012000140000e0001f00015000230002400012000080000700006000180000600017000110000600013000040001500001000
0118000018550185501a5501d5501a5501a5501d5501f5501a5501a55021550215501a5501a5502155023550245552455524555245552355523555235551f5502155021550215502155500000000000000000000
0118000018550185501a5501d5501a5501a5501d5501f5501a5501a55021550215501a5501a5502155023550245552455524555245552355523555265501f55021550215502155021550000001f0001f5551f555
011800001f550215501f5501a550000001c5501d5501c5501d5501d5501d5501d5501c5501c5501c5501c5501f550215501f5501a550000001c5501d5501c5501d5501d5501d5501d5501f5501f5501c5501c550
011800001c5501c5501c5501c55000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011800001557010570155701057015575155751557518570175701057017570105701757517575175751857015570105701557010570155751557515575185701757010570175701057017575175751757518570
011800002655021550265502155026555265552655529550285502155028550215502855528555285552955026550215502655021550265552655526555295502855021550285502155028555285552855529550
011800002155021550215501f55021550215501f5502155026550265502655026550265502655026550265502d5502d5502d5502b550295502955028550295502655026550265502655026550265502655026550
011800002155021550215501f55021550215501f5502155026550265502655026550265502655026550265502d5002d5002d5002b500295002950028500295002650026500265002650026500265002455023550
01180000285001a400000000000000000000000000000000000000000000000000002d5502f550305502f5502d5502d5502d5502d5502b5502b5502b5502b5502d5502d5502d5502d5502d5502d5502d5502d550
011800002155021550215502455023555235742455023550215502155021550285502355523574245502355021550215502155024550235552355424550235502155021550215502855023555235542455026550
011800002455024550245502455024550245502455024550235502355023550235502355023550235502355024550245502455024550245502455028550285502355023550235502355023550235502355023550
011800002155021550215502155021550215502155021555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011800080007100665186551864500071006650c655186450c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000021000
011800080067500605006750000500675000050067500605000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01100008000710c130000710c170000710c170000710c170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
00 0142430e
00 0242430e
00 0342430e
00 0405430d
00 0507430d
00 0508090d
00 050a430d
00 050b430d
00 0507430d
00 0508090d
00 050a430d
00 050b430d
02 0c42430e

